var wma_highzoom_activated=true;var wma_highzoom_purge=false;var wma_bldg3dzoom=14;var bldg3d=null,bldg3dc=null,bldg3dtimer=null;var update3dBuildings;var credit;var wmaNews=[];var wma_imgbase="tiles/";var wma_database="label.php";var wma_tilebase=".wma.wmflabs.org/tiles/";var wma_maxlabel=13;var i,wma_zoomsize=[3];for(i=1;i<40;i++){wma_zoomsize[i]=2*wma_zoomsize[i-1]}var lc={};var wma_tilesets=[{name:"mapFull",globe:"Earth",credit:' / Map data Â© <a href="http://www.openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://www.opendatacommons.org/licenses/odbl">License</a>',getTileURL:function(d,a,c,b){me=wma_tilesets[0];if(b||document.location.protocol=="https:"){if(c>=7){return wma_imgbase+"mapnik/"+c+"/"+d+"/tile_"+d+"_"+(a%(wma_zoomsize[c]*2))+".png"}else{return wma_imgbase+"mapnik/"+c+"/tile_"+d+"_"+(a%(wma_zoomsize[c]*2))+".png"}}else{if(c>=7){return"//"+((a+d)%8)+wma_tilebase+"mapnik/"+c+"/"+d+"/tile_"+d+"_"+(a%(wma_zoomsize[c]*2))+".png"}else{return"//"+((a+d)%8)+wma_tilebase+"mapnik/"+c+"/tile_"+d+"_"+(a%(wma_zoomsize[c]*2))+".png"}}},linkcolor:["#2255aa","1px 0px 2px white, 0px -1px 2px white, 0px 1px 2px white, -1px 0px 2px white"],equator:40075,maxzoom:20,minzoom:0},{name:"mapPhysical",globe:"Earth",getTileURL:function(c,a,b){return wma_imgbase+"relief/"+b+"/"+c+"_"+(a%(wma_zoomsize[b]*2))+".png"},linkcolor:["#2255aa","white 0pt 0pt 2pt"],equator:40075,maxzoom:5,minzoom:0},{name:"mapLandsat",globe:"Earth",getTileURL:function(e,a,d,c){var b=a%(wma_zoomsize[d]*2);if(b<0){b+=(wma_zoomsize[d]*2)}if(c||document.location.protocol=="https:"){return wma_imgbase+"mapnik/sat/"+d+"/"+e+"/"+e+"_"+(b%(wma_zoomsize[d]*2))+".png"}else{return"//"+((b+e)%8)+wma_tilebase+"mapnik/sat/"+d+"/"+e+"/"+e+"_"+(b%(wma_zoomsize[d]*2))+".png"}},linkcolor:["white","black 0pt 0pt 2pt"],equator:40075,maxzoom:13,minzoom:0},{name:"mapCoastline",globe:"Earth",getTileURL:function(c,a,b){return wma_imgbase+"plain/"+b+"/tile_"+c+"_"+(a%(wma_zoomsize[b]*2))+".png"},linkcolor:["#2255aa","1px 0px 2px white, 0px -1px 2px white, 0px 1px 2px white, -1px 0px 2px white"],equator:40075,maxzoom:7,minzoom:0},{name:"mapPhysical",globe:"Moon",getTileURL:function(d,a,c){var b=a%(wma_zoomsize[c]*2);if(b<0){b+=(wma_zoomsize[c]*2)}return wma_imgbase+"lro_moon/lromoon_"+("00"+(5-c))+"_"+("000"+b).substr(-3)+"_"+("000"+d).substr(-3)+".png"},linkcolor:["black","1px 0px 2px white, 0px -1px 2px white, 0px 1px 2px white, -1px 0px 2px white"],equator:10940.475,maxzoom:5,minzoom:0},{name:"mapLandsat",globe:"Moon",getTileURL:function(d,a,c){var b=a%(wma_zoomsize[c]*2);if(b<0){b+=wma_zoomsize[c]*2}return wma_imgbase+"moon/"+c+"/"+d+"_"+b+".jpg"},linkcolor:["white","1px 0px 2px black, 0px -1px 2px black, 0px 1px 2px black, -1px 0px 2px black"],equator:10940.475,maxzoom:7,minzoom:0},{name:"mapLandsat",globe:"Mars",getTileURL:function(d,a,c){var b=(a+wma_zoomsize[c])%(wma_zoomsize[c]*2);if(b<0){b+=wma_zoomsize[c]*2}return wma_imgbase+"mars/mars_"+("00"+(5-c))+"_"+("000"+b).substr(-3)+"_"+("000"+d).substr(-3)+".png"},linkcolor:["white","black 0pt 0pt 2pt"],equator:21359.975,maxzoom:5,minzoom:0},{name:"mapPhysical",globe:"Venus",getTileURL:function(d,a,c){var b=a%(wma_zoomsize[c]*2);if(b<0){b+=wma_zoomsize[c]*2}return wma_imgbase+"venus/venus_"+("00"+(3-c))+"_"+("000"+b).substr(-3)+"_"+("000"+d).substr(-3)+".png"},linkcolor:["white","1px 0px 2px black, 0px -1px 2px black, 0px 1px 2px black, -1px 0px 2px black"],equator:38024.6,maxzoom:3,minzoom:0},{name:"mapLandsat",globe:"Mercury",getTileURL:function(e,a,d){var b=(a+1*wma_zoomsize[d])%(wma_zoomsize[d]*2);if(b<0){b+=wma_zoomsize[d]*2}var c=6-d;return wma_imgbase+"mercury/"+((c<3)?(c+"/"):"")+((c==0)?(Math.floor(b/100)+"/"):"")+"merc_"+("00"+c)+"_"+("000"+b).substr(-3)+"_"+("000"+e).substr(-3)+".png"},linkcolor:["white","1px 0px 2px black, 0px -1px 2px black, 0px 1px 2px black, -1px 0px 2px black"],equator:15329.1,maxzoom:6,minzoom:0},{name:"mapLandsat",globe:"Io",getTileURL:function(d,a,c){var b=(a+wma_zoomsize[c])%(wma_zoomsize[c]*2);if(b<0){b+=wma_zoomsize[c]*2}return wma_imgbase+"io/io_"+("00"+(4-c))+"_"+("000"+b).substr(-3)+"_"+("000"+d).substr(-3)+".png"},linkcolor:["black","1px 0px 2px white, 0px -1px 2px white, 0px 1px 2px white, -1px 0px 2px white"],equator:11443.6,maxzoom:4,minzoom:0},{name:"mapLandsat",globe:"Titan",getTileURL:function(d,a,c){var b=a%(wma_zoomsize[c]*2);if(b<0){b+=wma_zoomsize[c]*2}return wma_imgbase+"titan/titan_"+("00"+(3-c))+"_"+("000"+b).substr(-3)+"_"+("000"+d).substr(-3)+".png"},linkcolor:["black","1px 0px 2px white, 0px -1px 2px white, 0px 1px 2px white, -1px 0px 2px white"],equator:16190.3,maxzoom:3,minzoom:0}];function parseParams(a){var d={},c,b,e=a.substr(a.indexOf("?")+1).split("&");for(b=0;b<e.length;++b){c=e[b].split("=");d[c[0]]=c[1]}return d}function isRTL(a){return($.inArray(a,["ar","he","fa"])>=0)}function wikiminiatlasInstall(ac,ai){var M="";var aT=500,af=300;var C=null;var n=false;var w,v;var l;var aj=[];var Q=null;var K={x:-1,y:-1};var E=0,D=0;var X=1;var U=0;var N={obj:null,lat:0,lon:0};var H=[];var au=true;var u=null;var A=null;var aN="de";var at="";var e="en";var aO=false;var az=0;var p=128,o=128;var y=null,c=null,Y=null;var f=null,ah=null,am=null;var ay={shown:false,panel:null,image:null,link:null};ai=ai||parseParams(window.location.href);var aM={},aP={shown:false,drawn:false,canvas:null,c:null,ways:null,areas:null,maxlat:-Infinity,minlat:Infinity};var aS={};var aB=false,aE=null;var aa="HTMLCanvasElement" in window;var s=("devicePixelRatio" in window)?window.devicePixelRatio:1;var z,h=null;function aQ(){var a3;var a0=ai.wma||(window.location.search).substr(1),a4=ai.page,aW=ai.lang,aU="";Y=ai.globe||"Earth";if(a4&&aa){$.ajax({url:"//tools.wmflabs.org/wiwosm/osmjson/getGeoJSON.php?lang="+aW+"&article="+a4,dataType:"json",success:a})}aE=(function(){if(!aa){return function(){}}var ba=$("<canvas></canvas>").attr({width:6*128*4/3,height:3*128*4/3}).css({display:"none"}),a7=$("<canvas></canvas>").attr({width:6*128,height:3*128}).css({display:"none"}),a9=$("<canvas></canvas>").attr({width:6*128,height:3*128}).css({display:"none"}),bc=$("<div></div>").css({position:"absolute",width:"80px",height:"80px",bottom:"20px",right:"5px",zIndex:50,display:"none",borderRadius:"40px","-moz-border-radius":"40px",boxShadow:"5px 5px 25px rgba(0, 0, 0, 0.3)"}),bb=$("<canvas></canvas>").attr({width:160,height:160}).css({position:"absolute",width:"80px",height:"80px",bottom:"20px",right:"5px",zIndex:51,display:"none"});function a8(){var bg,bf,be=0,bh=a7[0].getContext("2d"),bd=ba[0].getContext("2d");bh.clearRect(0,0,6*128,3*128);for(bg=0;bg<6;++bg){for(bf=0;bf<3;++bf){(function(bi,bk){var bj=new Image;$(bj).load(function(){bh.drawImage(bj,bi*128,bk*128);be++;if(be==3*6){bd.drawImage(a7[0],0,0,6*128*4/3,3*128*4/3);if(!aB){aB=wmaGlobe3d(bb[0],ba[0]);if(!aB){return}aB.setLatLon(N.lat,N.lon);bc.fadeIn(200);bb.fadeIn(200);aB.mapContext=bd;aB.tmap=a7[0];aB.tmapContext=bh;aB.omap=a9[0];aB.omapContext=a9[0].getContext("2d");aB.updateTiles=function(){aB.mapContext.clearRect(0,0,6*128*4/3,3*128*4/3);aB.mapContext.drawImage(aB.tmap,0,0,6*128*4/3,3*128*4/3);aB.updateTexture();aB.draw()};aB.updateKML=function(){aB.mapContext.clearRect(0,0,6*128*4/3,3*128*4/3);aB.mapContext.drawImage(aB.tmap,0,0,6*128*4/3,3*128*4/3);aB.mapContext.save();aB.mapContext.globalAlpha=0.5;ad(3*128,0,0,6*128,3*128,aB.omapContext);aB.mapContext.drawImage(aB.omap,0,0,6*128*4/3,3*128*4/3);aB.mapContext.restore();aB.updateTexture();aB.draw()}}if(aP.canvas){aB.updateKML()}else{aB.updateTiles()}}}).attr("src",wma_tilesets[az].getTileURL(bk,bi,0,true))})(bg,bf)}}}$("body").append(bb).append(ba).append(bc);return a8})();var aV=/([\d+-.]+)_([\d+-.]+)_([\d]+)_([\d]+)/;if(aV.test(a0)){aV.exec(a0);N.lat=parseFloat(RegExp.$1);N.lon=parseFloat(RegExp.$2);aT=$(window).width();af=$(window).height();aV=/([\d+-.]+)_([\d+-.]+)_([\d]+)_([\d]+)_([a-z-]+)/;if(aV.test(a0)){aV.exec(a0);at=RegExp.$5}aV=/([\d+-.]+)_([\d+-.]+)_([\d]+)_([\d]+)_([a-z-]+)_([\d]+)/;if(aV.test(a0)){aV.exec(a0);U=parseInt(RegExp.$6,10);aq(U);aq(Math.min(X,(az!=0?wma_tilesets[az].maxzoom:((aa&&wma_highzoom_activated)?15:12))));aq(Math.max(X,wma_tilesets[az].minzoom))}aV=/([\d+-.]+)_([\d+-.]+)_([\d]+)_([\d]+)_([a-z-]+)_([\d]+)_([a-z-]+)/;if(aV.test(a0)){aV.exec(a0);aN=RegExp.$7}else{aN=at}aV=/([\d+-.]+)_([\d+-.]+)_([\d]+)_([\d]+)_([a-z-]+)_([\d]+)_([a-z-]+)_([\d+-.]+)_([\d+-.]+)/;if(aV.test(a0)){a3=P(RegExp.$8,RegExp.$9);au=false;n=true}else{a3=P(N.lat,N.lon);au=true}E=a3.x-aT/2;D=a3.y-af/2}at=at.split("-")[0];e=aN;if(e=="co"||e=="commons"){e="en"}aO=isRTL(e);wmajt.setUILang(e);for(a1 in strings){if(!strings[a1][e]){strings[a1][e]=strings[a1].en}}a6='<div class="bsprite" id="button_plus" title="'+strings.zoomIn[e]+'"></div><div class="bsprite" id="button_minus" title="'+strings.zoomOut[e]+'"></div><div class="bsprite" id="button_target" title="'+strings.center[e]+'"></div><div class="bsprite" id="button_kml" title="'+strings.kml[e]+'"></div><div class="bsprite" id="button_menu" title="'+strings.settings[e]+'"></div>';if(n){a6+='<img id="button_hide" src="'+wma_imgbase+'button_hide.png" title="'+strings.close[e]+'" onclick="window.close()">'}else{a6+='<img id="button_fs" src="'+wma_imgbase+'button_fs.png" title="'+strings.fullscreen[e]+'">'}a6+='<div id="wma_map" style="position:absolute; width:'+aT+"px; height:"+af+'px; cursor: move; background-color: #aaaaaa;"></div>';a6+='<div id="scalebox"><div id="scalebar"></div><div id="scalelabel">null</div></div>';a6+='<div id="synopsis"><p id="synopsistext"></p></div>';a6+='<div id="wma_settings"><h4>'+strings.settings[e]+'</h4><p class="option">Size Comparison <select id="wmaSetSizeOverlay">';var aY=strings.sover[e].list;a6+='<option value="-" class="bg" selected="selected">-</option>';a6+='<option value="+" class="bg">'+strings.other[e]+"</option>";a6+='<option value="*" class="bg">'+decodeURIComponent(a4)+"</option>";for(a1 in aY){a6+='<option value="'+aY[a1]+'">'+aY[a1]+"</option>"}a6+='</select></p><a href="//wma.wmflabs.org/" target="_top"><img src="//upload.wikimedia.org/wikipedia/commons/4/46/Powered_by_labs_button.png" border="0"></a></div>';ac.html(a6).append($("<span></span>",{id:"wmacredit"}).append($("<a></a>",{href:"//meta.wikimedia.org/wiki/WikiMiniAtlas/"+aN,target:"_top"}).text("WikiMiniAtlas")).append(credit=$("<span></span>")));var aX=new wmaMenu(aO);(function(){var bb,ba,a9=[],bc,a8;aX.addTitle(strings.labelSet[e],aO);a8='<select id="wmaLabelSet">';if(at in wikiminiatlas_sites){a8+='<option value="'+at+'" selected="selected">'+wikiminiatlas_sites[at]+"</option>"}if(at!==e&&e in wikiminiatlas_sites){a8+='<option value="'+e+'">'+wikiminiatlas_sites[e]+"</option>"}if(at in wikiminiatlas_sites||e in wikiminiatlas_sites){a8+="<option disabled></option>"}for(bb in wikiminiatlas_sites){if(bb!=="commons"){a8+='<option value="'+bb+'">'+wikiminiatlas_sites[bb]+"</option>"}}a8+="</select>";bc=aX.addGroup([["LANG",a8],["commons",strings.commons[e]]],function(be){if(be=="LANG"){be=bc.items.LANG.find("select option:selected").val()}aA(be)},at=="commons"?"commons":"LANG",aO);bc.items.LANG.find("select").click(function(be){be.stopPropagation()}).change(function(be){bc.items.LANG.click()});aX.addSep();var bd={};for(bb=0;bb<wma_tilesets.length;++bb){ba=wma_tilesets[bb].globe;bd[ba]=bd[ba]||[];bd[ba].push([bb,strings[wma_tilesets[bb].name][e]||""])}a6='<select id="wmaGlobeSet">';for(bb in bd){a6+='<option value="'+bb+'"';if(bb==Y){a6+='selected="selected"'}a6+=">"+strings["map"+bb][e]+"</option>"}a6+="</select>";aX.addTitle(strings.solarSystem[e],aO);var a7=aX.addItem(a6,undefined,aO);a7.find("select").click(function(be){be.stopPropagation()}).change(function(be){var bf=$(this).find("option:selected").val();bd[Y].hide();bd[bf].show();Y=bf;a7.click();aF(bd[bf].current())});aX.addSep();aX.addTitle(strings.mode[e],aO);for(bb in bd){bd[bb]=aX.addGroup(bd[bb],aF,bd[bb][0][0],aO);if(bb!==Y){bd[bb].hide()}aX.addSep()}aX.addItem(strings.sizeRef[e],b)})();$("#button_menu").click(function(){aX.toggle()});$("#button_fs").click(ak);$("#wma_widget").append(aX.div.css({right:"40px",top:"26px"}));aY=strings.dyk[e];var a5=$("<div></div>").html(aY[Math.floor(Math.random()*aY.length)]).addClass("news");z=$("<div></div>").css({position:"absolute",top:"30px",left:"60px",zIndex:100,fontSize:"40px",color:"white",textShadow:"1px 1px 5px black",fontWeight:"bold"}).appendTo("#wma_widget");wmaNews[0]=function(){aF(4)};wmaNews[1]=function(){if(aa){E=19039255;D=3363704;aq(15);aF(0)}else{a5.text("Sorry, your browser does not support the canvas element! Try FireFox or Google Chrome.")}};$("#wma_widget").append(a5);a5.click(function(){a5.fadeOut()});setTimeout(function(){a5.fadeOut()},10*1000);y=$("#scalelabel");c=$("#scalebar");u=document.getElementById("button_target");A=document.getElementById("wma_settings");$("#wmaLabelSet").change(function(){aA(this.value)});$("#wmaSetSizeOverlay").change(function(){ar(strings.sover[e].site,this.value)});$("#button_plus").on("mousedown",ab);$("#button_minus").on("mousedown",R);$("#button_target").on("click",ag);$("#button_kml").on("click",ap);$(document).on("keydown",L);$(document).on("contextmenu",function(){return false});$("body").bind("dragstart",function(){return false});$("#wma_map").click(function(a8){var a7=aL(a8);if(a7.x!=K.x||a7.y!=K.y){return false}});S();bldg3d=$('<canvas class="wmakml"></canvas>').attr({width:aT*s,height:af*s}).css({zIndex:19,opacity:0.75,width:aT+"px",height:af+"px"}).appendTo($(C));if(aa){try{bldg3dc=bldg3d[0].getContext("experimental-webgl");update3dBuildings=aD(bldg3dc)}catch(a2){bldg3dc=null;bldg3d.remove();bldg3d=$('<canvas class="wmakml"></canvas>').attr({width:aT*s,height:af*s}).css({zIndex:19,opacity:0.75,width:aT+"px",height:af+"px"}).appendTo($(C))}if(!bldg3dc||update3dBuildings===false){bldg3dc=bldg3d[0].getContext("2d");bldg3dc.scale(s,s);update3dBuildings=q}}$(window).resize(W);var a6,a1,aY;for(a1=0;a1<wma_tilesets.length&&wma_tilesets[a1].globe!=Y;++a1){}aF(a1,true);aI();d();ah=/https?:\/\/([a-z-]+)\.wikipedia\.org\/wiki\/(.*)/;$("#wma_widget").mouseover(function(a9){var a7,a8;if(a9.metaKey||a9.ctrlKey){if(a9.target.href&&ah.test(a9.target.href)){a7=RegExp.$1;a8=RegExp.$2;$("#synopsistext").load("/summary/?l="+a7+"&t="+a8,function(){$("#synopsistext").css("direction",isRTL(a7)?"rtl":"ltr").find("a").attr("target","_top");$("#synopsis").fadeIn("slow");setTimeout(function(){var bb=$("#synopsistext").outerHeight(true),ba=af/2;$("#synopsis").animate({height:bb<ba?bb:ba})},500)})}else{$("#synopsis").fadeOut("fast")}}});$("#synopsis").click(function(a7){if(a7.target==this){$("#synopsis").fadeOut("fast")}});if(window.postMessage){$(window).bind("message",ao);if(window!=window.top){try{window.parent.postMessage("request","*")}catch(aZ){}}}}function aJ(){if(ac.css("visibility")!="visible"){ac.css("visibility","visible")}else{ac.css("visibility","hidden")}return false}function b(){if(A.style.visibility!="visible"){A.style.visibility="visible"}else{A.style.visibility="hidden"}return false}function ae(){var aW=$("<div></div>").addClass("wmatile").on("mousedown touchstart",an).click(function(aZ){var aX,aY=aL(aZ);if(aY.x!=K.x||aY.y!=K.y||!aU.csrender){return true}aX=wmajt.detectPointer(aZ,aU);if(aX){av(aX)}}),aV=null,aU={div:aW,img:$("<img>").load(function(aX){$(this).fadeIn(100)}).error(function(aX){aV=setTimeout(function(){var aY=aU.img.attr("src");aU.img.attr("src",aY.replace(/\?.*/,"")+"?"+Math.random())},1*1000)}).appendTo(aW),can:$("<canvas></canvas>").appendTo(aW),ctx:null,csrender:false,csx:0,csy:0,csz:20,lx:0,ly:0,lz:20,span:$("<span></span>").appendTo(aW),debug:$("<span></span>").addClass("wmadbg").css("display","none").appendTo(aW),url:"",xhr:null};if(aa){if(s>1){aU.can.attr({width:128*s,height:128*s}).css({width:"128px",height:"128px"});aU.ctx=aU.can[0].getContext("2d");aU.ctx.scale(s,s)}else{aU.can.attr({width:128,height:128});aU.ctx=aU.can[0].getContext("2d")}}$(C).append(aU.div);return aU}function S(){var aV,aU;if(C===null){$(document).on("mousemove touchmove",function(aW){aG(aW);aW.preventDefault()}).on("mouseup touchend",function(){Q=null});$("#wma_map").on("dblclick",V).on("mousedown touchstart",an);C=document.getElementById("wma_map");w=Math.floor(aT/p)+2;v=Math.floor(af/o)+2;l=[];for(var aU=0;aU<v;++aU){for(var aV=0;aV<w;++aV){l.push(ae())}}N.obj=$('<div id="wmamarker"></div>');$(C).append(N.obj)}}function W(){var aV=$(window).width(),aX=$(window).height(),aU=Math.floor(aV/p)+2,aY=Math.floor(aX/o)+2,aW;aT=aV;af=aX;if(aa){if(aP.canvas!==null){aP.canvas.attr({width:aV*s,height:aX*s}).css({width:aV+"px",height:aX+"px"});aP.c.setTransform(s,0,0,s,0,0)}bldg3d.attr({width:aV*s,height:aX*s}).css({width:aV+"px",height:aX+"px"});if(bldg3dc.viewport){bldg3dc.viewport(0,0,aV*s,aX*s)}}if(aU!=w||aY!=v){w=aU;v=aY;while(l.length<aU*aY){l.push(ae())}for(aW=0;aW<l.length;++aW){if(aW<aU*aY){l[aW].div.show()}else{l[aW].div.hide()}}aI();$(C).width(aV).height(aX)}else{if(aP.shown){ad()}}}function ap(){if(aP.shown){aP.canvas.fadeOut(200)}else{aP.canvas.fadeIn(200)}aP.shown=!aP.shown}function I(aW){var aY,aX,aV,aZ=aM.c,a2=aM.ways,a0=aM.areas,aU,a4=E,a3=D;function a1(a5){var a7,ba,a8,a6,a9;if(a5.length>0){a9=a5[0].lat+aW.lat;ba=ax(a9,a5[0].lon/Math.cos(a9/180*Math.PI)+aW.lon);a8=ba.x;aZ.moveTo(ba.x-a4,ba.y-a3);for(a7=1;a7<a5.length;++a7){a9=a5[a7].lat+aW.lat;ba=ax(a9,a5[a7].lon/Math.cos(a9/180*Math.PI)+aW.lon);aZ.lineTo(ba.x-a4,ba.y-a3)}}}if(aZ!==null){aZ.clearRect(0,0,aM.canvas[0].width,aM.canvas[0].height);if(a0!==null){aZ.fillStyle="rgb(0, 255, 0)";for(aY=0;aY<a0.length;aY++){aZ.globalCompositeOperation="source-over";for(aX=0;aX<a0[aY].outer.length;++aX){aZ.beginPath();a1(a0[aY].outer[aX]);aZ.closePath();aZ.fill()}aZ.globalCompositeOperation="destination-out";for(aX=0;aX<a0[aY].inner.length;++aX){aZ.beginPath();a1(a0[aY].inner[aX]);aZ.closePath();aZ.fill()}}}if(a2!==null){aZ.globalCompositeOperation="source-over";aZ.lineWidth=4;aZ.strokeStyle="rgb(0, 255, 0)";aZ.beginPath();for(aY=0;aY<a2.length;++aY){a1(a2[aY])}aZ.stroke()}}}function ad(a1,aW,aV,aY,a7,a2){var a0,aZ,aX,a5=aP.ways,a3=aP.areas,aU,a8,a6,a9;a1=a1||wma_zoomsize[X]*p;aW=(aW!==undefined)?aW:E;aV=(aV!==undefined)?aV:D;a2=a2||aP.c;a9=aW;function a4(ba){var bc,bf,be=0,bd,bb;if(ba[0].lon<aP.minlon){be=2*a1}if(ba.length>0){bf=ax(ba[0].lat,ba[0].lon,a1);bd=bf.x;a2.moveTo(bf.x-a9+be,bf.y-aV);for(bc=1;bc<ba.length;++bc){bf=P(ba[bc].lat,ba[bc].lon,a1);bb=bf.x-bd;if(Math.abs(bb)>a1){be-=Math.round(bb/(2*a1))*2*a1}bd=bf.x;a2.lineTo(bf.x-a9+be,bf.y-aV)}}}if(a2!==null){aY=aY||aP.canvas[0].width;a7=a7||aP.canvas[0].height;a2.clearRect(0,0,aY,a7);for(aX=-2;aX<=2;++aX){a9=aW+aX*2*a1;a8=ax(0,aP.minlon,a1);a6=ax(0,aP.maxlon,a1);if(a6.x-a9<0||a8.x-a9>aY){continue}if(a3!==null){a2.fillStyle="rgb(255, 0, 0)";a2.strokeStyle="rgb(0, 0, 0)";a2.lineWidth=2;for(a0=0;a0<a3.length;++a0){a2.globalCompositeOperation="source-over";for(aZ=0;aZ<a3[a0].outer.length;++aZ){a2.beginPath();a4(a3[a0].outer[aZ]);a2.closePath();a2.fill();a2.stroke()}a2.globalCompositeOperation="destination-out";for(aZ=0;aZ<a3[a0].inner.length;++aZ){a2.beginPath();a4(a3[a0].inner[aZ]);a2.closePath();a2.fill();a2.stroke()}}}if(a5!==null){a2.globalCompositeOperation="source-over";a2.lineWidth=4;a2.strokeStyle="rgb(0, 0, 255)";a2.beginPath();for(a0=0;a0<a5.length;++a0){a4(a5[a0])}a2.stroke()}}}}function aI(){function aZ(bl,bj){var bo,bn,bk,bm,bi=[0,0,5,0,0,2,3,4,5,6,6],bg=[0,0,8,0,0,2,3,4,5,6,6];bl.text("");for(bk=0;bk<bj.length;++bk){bn=$("<a></a>");if("img" in bj[bk]){(function(bs,bp,bq,br){bn.click(function(bu){var bt=aL(bu);if(bt.x!=K.x||bt.y!=K.y){bu.preventDefault()}else{if(bu.which==1&&(!bu.ctrlKey)){m(bs,bp,bq,br);bu.preventDefault()}}}).attr("href","//commons.wikimedia.org/wiki/File:"+bj[bk].img)})(bj[bk].img,bj[bk].w,bj[bk].h,bj[bk].m5);bo=(parseInt(bj[bk].w)>parseInt(bj[bk].h))?(bj[bk].style==-2?24:48):Math.floor((bj[bk].style==-2?24:48)*bj[bk].w/bj[bk].h);bn.addClass("cthumb").append($("<img/>",{title:decodeURIComponent(bj[bk].img)}).error(function(){$(this).parent().hide()}).attr({src:G(bj[bk].img,bo,bj[bk].m5),srcset:(2*bo<=bj[bk].w)?(G(bj[bk].img,bo*2,bj[bk].m5)+" 2x"):""}));if(bj[bk].head<18){bn.addClass("dir dir"+bj[bk].head);bm=8}else{bm=6}bn.css({top:(bj[bk].ty-bm)+"px",left:(bj[bk].tx-bm)+"px"})}else{bn.addClass("label").addClass("label"+bj[bk].style).addClass("label-"+bj[bk].lang).css(aS).attr({href:"//"+bj[bk].lang+".wikipedia.org/wiki/"+bj[bk].page,target:"_top"}).css({top:(bj[bk].ty-bg[bj[bk].style])+"px",left:(bj[bk].tx-bi[bj[bk].style])+"px",direction:isRTL(bj[bk].lang)?"rtl":"ltr"});var bh=/(.*?)(\s*\([^\)]*\)$|\s*, [^, \(]*$)/.exec(bj[bk].name);if(bh){bn.text(bh[1]).append($('<span class="hell">&hellip;</span>')).append($('<span class="sufx"></span>').text(bh[2]).hide()).hover(function(){$(".hell",this).hide();$(".sufx",this).show()},function(){$(".hell",this).show();$(".sufx",this).hide()})}else{bn.text(bj[bk].name)}}bl.append(bn)}}function a9(bn,bi){var br=bn.lx,bq=bn.ly,bp=bn.lz,bm=1<<(bp-wma_maxlabel),bt,bs,bo,bl,bj,bh=[],bk,bg=[[],[],[],[]];for(bk=0;bk<bi.length;++bk){bt=128*(br/bm-bi[bk].dx);bs=128*(bq/bm-(wma_zoomsize[wma_maxlabel]-bi[bk].dy-1));bl=(bi[bk].tx+bi[bk].fx-bt)*bm;bj=(bi[bk].ty+bi[bk].fy-bs)*bm;if(bl>=0&&bl<128&&bj>=0&&bj<128){bo=jQuery.extend(true,{},bi[bk]);bo.tx=Math.floor(bl);bo.ty=Math.floor(bj);bo.fx=bl-bo.tx;bo.fy=bj-bo.ty;bg[Math.floor(bl/64)+2*Math.floor(bj/64)].push(bo)}}for(bk=0;bk<4;++bk){if(bg[bk].length>0){bg[bk].sort(function(bv,bu){return bu.wg-bv.wg});bh.push(bg[bk][0])}}aZ(bn.span,bh)}if(D<0){D=0}if(E<0){E+=Math.floor(wma_zoomsize[X]*2*p)}if(E>0){E%=Math.floor(wma_zoomsize[X]*2*p)}var a0=Math.floor(E/p)%w,aY=Math.floor(D/o)%v,aX=E%p,aW=D%o,a8,a6,aU,bf,be,bd,bc,bb,a5,a4,ba,a7,a1,aV;t();var a3=new Date;for(var bc=0;bc<v;bc++){for(var bd=0;bd<w;bd++){ba=((bd+a0)%w)+((bc+aY)%v)*w;a5=(Math.floor(E/p)+bd);a4=(Math.floor(D/o)+bc);a1=wma_tilesets[az].getTileURL(a4,a5,X);a7=l[ba];a7.div.css({left:(bd*p-aX)+"px",top:(bc*o-aW)+"px"});if(a7.url!=a1||wma_highzoom_purge){a7.url=a1;if(az==0&&X>12){if(!a7.csrender){a7.csrender=true;a7.img.fadeOut(200)}if(a7.csx!=a5||a7.csy!=a4||a7.csz!=X||wma_highzoom_purge){a7.can.hide();a7.img.hide();wmajt.update(a5,a4,X,a7,wma_highzoom_purge)}}else{a7.csz=X;if(a7.csrender){a7.can.fadeOut(200)}if(a4>=wma_zoomsize[X]){a7.img.fadeOut(0);a7.span.text("");continue}if(a7.img.attr("src")!=a1){a7.img.fadeOut(0).attr("src",a1)}else{if(a7.csrender){a7.img.fadeIn(200)}}a7.csrender=false}if(a7.xhr!==null){a7.xhr.abort()}a7.lx=a5;a7.ly=a4;a7.lz=X;a7.span.html('<span class="loading">'+strings.labelLoading[e]+"</span>");if(X>wma_maxlabel){a8=Math.floor(a5/(1<<(X-wma_maxlabel)));a6=Math.floor(a4/(1<<(X-wma_maxlabel)));aV=aK(a6,a8,wma_maxlabel);aU=J(a6,a8,wma_maxlabel)}else{aV=aK(a4,a5,X);aU=J(a4,a5,X)}if(lc[aU]&&!("filler" in lc[aU])){if(X<wma_maxlabel){aZ(a7.span,lc[aU].label)}else{a9(a7,lc[aU].label)}}else{if(lc[aU]&&"filler" in lc[aU]){aZ(a7.span,lc[aU].label)}else{if(X<=wma_maxlabel&&X>0){bf=J(Math.floor(a4/2),Math.floor(a5/2),X-1);if(lc[bf]){a8=a5%2;lc[aU]={label:[],filler:1};for(bb=0;bb<lc[bf].label.length;bb++){if(Math.floor(lc[bf].label[bb].tx/64)===(a5%2)&&Math.floor(lc[bf].label[bb].ty/64)===(a4%2)){be=jQuery.extend(true,{},lc[bf].label[bb]);be.tx=(be.tx+be.fx)*2-(a5%2)*128;be.ty=(be.ty+be.fy)*2-(a4%2)*128;be.fx=be.tx-Math.floor(be.tx);be.fy=be.ty-Math.floor(be.ty);be.tx=Math.floor(be.tx);be.ty=Math.floor(be.ty);lc[aU].label.push(be)}}aZ(a7.span,lc[aU].label)}}}(function(bi,bh,bg){a7.xhr=$.ajax({url:bh,context:a7}).success(function(bj){try{lc[bi]=JSON.parse(bj);bg?aZ(this.span,lc[bi].label):a9(this,lc[bi].label)}catch(bk){this.span.html(bj)}}).error(function(){this.span.text("")})})(aU,aV,X<wma_maxlabel)}}}}g(N);for(ba=0;ba<H.length;++ba){g(H[ba])}wma_highzoom_purge=false;if(X>=wma_bldg3dzoom){update3dBuildings()}ad();var a2=new Date}function aD(aY){aY.clearColor(0,0,0,0);aY.clearDepth(1);aY.enable(aY.DEPTH_TEST);aY.depthMask(true);aY.depthFunc(aY.LEQUAL);aY.clear(aY.COLOR_BUFFER_BIT+aY.DEPTH_BUFFER_BIT);var aX=aY.createProgram();var aZ=aY.createShader(aY.VERTEX_SHADER);aY.shaderSource(aZ,$("#bldg-vs").text());aY.compileShader(aZ);aY.attachShader(aX,aZ);var a0=aY.createShader(aY.FRAGMENT_SHADER);aY.shaderSource(a0,$("#bldg-fs").text());aY.compileShader(a0);aY.attachShader(aX,a0);aY.linkProgram(aX);aY.useProgram(aX);aX.vertexPosAttrib=aY.getAttribLocation(aX,"pos");aY.enableVertexAttribArray(aX.vertexPosAttrib);aX.normalPosAttrib=aY.getAttribLocation(aX,"norm");aY.enableVertexAttribArray(aX.normalPosAttrib);var a1=aY.getUniformLocation(aX,"u_resolution");var a3=aY.getUniformLocation(aX,"u_centerdeg");var a2=aY.getUniformLocation(aX,"u_lightdir");var aW=3,aV=2,aU=5;r=Math.sqrt(aW*aW+aV*aV+aU*aU);aY.uniform3f(a2,aW/r,aV/r,aU/r);wmajt.registerWebGLBuildingData(5000,aY,aX);return function(){var a6=aT/2,a5=af/2,a4=60/(128*1<<X),a7=aH(E+a6,D+a5);if(a7.lon>180){a7.lon-=360}aY.uniform3f(a1,a6*a4,a5*a4,850);aY.uniform3f(a3,a7.lon,a7.lat,0);aY.clear(aY.COLOR_BUFFER_BIT|aY.DEPTH_BUFFER_BIT);wmajt.renderWebGLBuildingData()}}function q(){if(aa&&X>wma_bldg3dzoom){var aV=wmajt.ref_z(),aU=wmajt.zbuild(),a7=aT/2,a6=af/2,a0=(128*1<<X)/60,aY,aX,a3=bldg3dc,a1,aW,a2,aZ,a4=aH(E+a7,D+a6);if(a4.lon>180){a4.lon-=360}function a5(a9){var a8;if(aW>0){a3.moveTo((a9[0][0]-a4.lon)*aY+a7,a6-(a9[0][1]-a4.lat)*aY);for(a8=1;a8<a9.length;a8++){a3.lineTo((a9[a8][0]-a4.lon)*aY+a7,a6-(a9[a8][1]-a4.lat)*aY)}}for(a8=0;a8<a9.length-1;a8++){a3.moveTo((a9[a8][0]-a4.lon)*aY+a7,a6-(a9[a8][1]-a4.lat)*aY);a3.lineTo((a9[a8][0]-a4.lon)*aX+a7,a6-(a9[a8][1]-a4.lat)*aX);a3.lineTo((a9[a8+1][0]-a4.lon)*aX+a7,a6-(a9[a8+1][1]-a4.lat)*aX)}}a3.lineWidth=0.5;a3.strokeStyle="rgb(0, 0, 0)";a3.beginPath();bldg3dc.clearRect(0,0,aT,af);for(aZ in aV){a2=aU[aZ].geo.coordinates;a1=(aU[aZ].tags["building:levels"]*3)||aU[aZ].tags.height;aW=(aU[aZ].tags["building:min_level"]*3)||aU[aZ].tags.min_height||0;aY=a0*(1+aW/450);aX=a0*(1+a1/450);if(aU[aZ].geo.type==="Polygon"){for(aZ=0;aZ<a2.length;aZ++){a5(a2[aZ])}}else{a5(a2)}}a3.stroke();bldg3d.show();if(bldg3dtimer!==null){clearTimeout(bldg3dtimer)}setTimeout(update3dBuildings,1500)}else{bldg3d.hide()}}function g(aU){var aV=P(aU.lat,aU.lon),aW=(aV.x-E);if(aW<-100){aW+=(wma_zoomsize[X]*256)}aU.obj.css("left",(aW-6)+"px");aU.obj.css("top",(aV.y-D-6)+"px")}function an(aU){K=Q=aL(aU)}function aG(aU){window.scrollTo(0,0);var aW=aL(aU);if(Q!==null){E-=(aW.x-Q.x);D-=(aW.y-Q.y);Q=aW;aI();if(au){au=false;d()}}if(aM.shown){I(aH(E+aW.x,D+aW.y))}var aV=aH(E+aT/2,D+af/2);aB&&aB.setLatLon(aV.lat,aV.lon)}function V(aU){var aV=aL(aU);E+=aV.x-aT/2;D+=aV.y-af/2;if(au){au=false;d()}aI();return false}function av(aU){if(h){clearTimeout(h)}z.stop(true).fadeTo(1,1).text(aU);h=setTimeout(function(){z.fadeOut(200)},5000)}function aq(aU){X=aU;if(bldg3d){if(aU>=wma_bldg3dzoom){bldg3d.show()}else{bldg3d.hide()}}}function ar(aV,aU){if(aU=="+"){aU=prompt("Enter article title to use as overlay");if(!aU){return}}if(aU=="*"){aU=ai.page;aV=ai.lang}if(aU=="-"){aM.shown=false;aM.canvas.fadeOut(200);return}O(aV,aU);b()}function O(aV,aU){$.ajax({url:"//tools.wmflabs.org/wiwosm/osmjson/getGeoJSON.php?lang="+aV+"&article="+aU,dataType:"json",success:aw})}function L(aX){var aV=false;aX=aX||window.event;switch(aX.keyCode||aX.which){case 37:E-=aT/1;break;case 38:D-=af/1;break;case 39:E+=aT/1;break;case 40:D+=af/1;break;case 187:case 107:ab();break;case 189:case 109:R();break;case 80:wma_highzoom_purge=true;aI();break;case 79:if(aM.shown){aM.shown=false;aM.canvas.fadeOut(200)}else{O(strings.sover[e].site,strings.sover[e].list[0])}break;case 84:aF((az+1)%wma_tilesets.length);break;case 76:var aW,aY,aU=["en","de","fr","ru","ar","he","ko","ja","ml","fa","commons"];aW=aU[($.inArray(at,aU)+1)%aU.length];z.text(wikiminiatlas_sites[aW]);aA(aW,true);break;case 67:aA("commons",true);break;case 27:if(aM.shown){aM.shown=false;aM.canvas.fadeOut(200)}if(ay.shown){T()}if(A.style.visibility!="hidden"){A.style.visibility="hidden"}break;default:aV=true}if(au){au=false;d()}aI();return aV}function aL(aU){var aV=aU.originalEvent;if("touches" in aV){return{x:aV.touches[0].pageX,y:aV.touches[0].pageY}}else{return{x:aU.pageX,y:aU.pageY}}}function J(aW,aU,aV){return at+"_"+(wma_zoomsize[aV]-aW-1)+"_"+(aU%(wma_zoomsize[aV]*2))+"_"+aV+"_"+wma_tilesets[az].globe}function aK(aW,aU,aV){return wma_database+"?l="+at+"&a="+(wma_zoomsize[aV]-aW-1)+"&b="+(aU%(wma_zoomsize[aV]*2))+"&z="+aV+"&g="+wma_tilesets[az].globe}function aR(){var aV=wma_tilesets[az].globe;for(var aU=az+1;aU<wma_tilesets.length;aU++){if(wma_tilesets[aU].maxzoom>=(X+1)&&wma_tilesets[aU].globe==aV){az=aU;X++;return}}}function k(){for(var aU=az-1;aU>=0;aU--){if(wma_tilesets[aU].minzoom<(X-1)){az=aU;X--;return}}}function ab(aV){var aW=aH(E+aT/2,D+af/2);var aU=false;if(!aV){aV=window.event}if(aV){if(aV.which){aU=(aV.which==3)}else{if(aV.button){aU=(aV.button==2)}}}if(aU){if(aa&&wma_highzoom_activated){aq((az==0)?15:wma_tilesets[az].maxzoom)}else{aq((az==0)?12:wma_tilesets[az].maxzoom)}}else{if(X>=((az==0&&!(aa&&wma_highzoom_activated))?12:wma_tilesets[az].maxzoom)){}else{aq(X+1)}}var aX;if(au){aX=P(N.lat,N.lon)}else{aX=P(aW.lat,aW.lon)}E=aX.x-aT/2;D=aX.y-af/2;aI();return false}function R(aV){var aW=aH(E+aT/2,D+af/2);var aU=false;if(!aV){aV=window.event}if(aV){if(aV.which){aU=(aV.which==3)}else{if(aV.button){aU=(aV.button==2)}}}if(aU){aq(wma_tilesets[az].minzoom)}else{if(X<=wma_tilesets[az].minzoom){k()}else{aq(X-1)}}var aX=P(aW.lat,aW.lon);E=aX.x-aT/2;D=aX.y-af/2;aI();return false}function aF(aY,aX){var aV=X;az=aY;aS={color:wma_tilesets[aY].linkcolor[0],textShadow:wma_tilesets[aY].linkcolor[1]};$("a.label").css(aS);credit.text("");if("credit" in wma_tilesets[aY]){credit.html(wma_tilesets[aY].credit)}if(aV>(aY!=0?wma_tilesets[aY].maxzoom:((aa&&wma_highzoom_activated)?15:12))){aV=wma_tilesets[aY].maxzoom}if(aV<wma_tilesets[aY].minzoom){aV=wma_tilesets[aY].minzoom}if(X!=aV){var aU=aH(E+aT/2,D+af/2);aq(aV);var aW=P(aU.lat,aU.lon);E=aW.x-aT/2;D=aW.y-af/2}if(!aX){aI()}aE()}function aA(aU){at=aU;for(var aV=0;aV<w*v;++aV){l[aV].url=""}aI()}function t(){var aW=aH(E+aT/2,D+af/2);var aV=50,aY;var aU,aX;aU=Math.cos(aW.lat*0.0174532778)*wma_tilesets[az].equator*aV/(256*wma_zoomsize[X]);aX=Math.pow(10,Math.floor(Math.log(aU)/Math.log(10)));aY=aV*aX/aU;if(5*aY<aV){aY=aY*5;aX=aX*5}if(2*aY<aV){aY=aY*2;aX=aX*2}y.text(aX<1?(aX*1000)+" m":aX+" km");c.width(aY)}function d(){if(au){$("#button_target").css("background-position","")}else{$("#button_target").css("background-position","-40px 0")}}function aC(aU,aW){var aV=P(aU,aW);E=aV.x-aT/2;D=aV.y-af/2;aI()}function ag(){aC(N.lat,N.lon);au=true;d()}function ax(aV,aW,aU){aU=aU||wma_zoomsize[X]*p;return{y:Math.floor((0.5-aV/180)*aU),x:Math.floor((aW/360)*aU*2)}}function P(aV,aW,aU){aU=aU||wma_zoomsize[X]*p;var aX=Math.floor((aW/360)*aU*2);if(aX<0){aX+=aU*2}return{y:Math.floor((0.5-aV/180)*aU),x:aX}}function aH(aU,aV){return{lat:180*(0.5-aV/(wma_zoomsize[X]*128)),lon:360*(aU/(wma_zoomsize[X]*256))}}function Z(aU){$("#debugbox").append($("<div></div>").text(aU))}function G(aV,aU,aW){return aW?"//upload.wikimedia.org/wikipedia/commons/thumb/"+aW[0]+"/"+aW+"/"+aV+"/"+aU+"px-"+aV:"//commons.wikimedia.org/w/thumb.php?w="+aU+"&f="+aV}function T(){ay.shown=false;ay.panel.fadeOut(200)}function B(){ay.panel=$("<div></div>",{id:"wma_wmaci_panel"}).append($("<div></div>",{id:"wma_wmaci_panel_sub"}).append(ay.span=$("<span></span>")).append($("<br/>")).append(ay.link=$("<a></a>",{id:"wma_wmaci_link",target:"_top"}).click(function(aU){aU.stopPropagation()}))).css("visibility","visible").hide().click(T).appendTo(ac)}function m(aU,a1,aY,a0){if(ay.panel==null){B()}var aZ=aT-30;var aW=af-80;var aV=a1;var a2=aY;if(aV>aZ){a2=Math.round((a2*aZ)/aV);aV=aZ}if(a2>aW){aV=Math.round((aV*aW)/a2);a2=aW}ay.span.find("img").remove();var aX=$("<img/>",{id:"wma_wmaci_image"}).appendTo(ay.span);if(aV*2<a1){aX.attr({src:G(aU,Math.floor(aV/10)*10,a0),srcset:G(aU,Math.floor(aV/10)*20,a0)+" 2x"})}else{if(aV<a1){aX.attr({src:G(aU,Math.floor(aV/10)*10,a0)})}else{aX.attr("src","//commons.wikimedia.org/wiki/Special:FilePath/"+aU)}}ay.link.attr("href","//commons.wikimedia.org/wiki/File:"+aU).text("[[:commons:File:"+decodeURIComponent(aU)+"]]");ay.panel.fadeIn(200);ay.shown=true}function ak(){var aU=window.open("","showwin","left=0, top=0, width="+screen.width+", height="+screen.height+", toolbar=0, resizable=0, fullscreen=1"),aW=ai.page,aX=ai.lang,aY=wma_tilesets[az].globe,aV=aH(E+aT/2,D+af/2);aU.document.location=document.location.pathname+"?"+N.lat+"_"+N.lon+"_"+0+"_"+0+"_"+at+"_"+X+"_"+aN+"_"+aV.lat+"_"+aV.lon+"&globe="+aY+"&page="+aW+"&lang="+aX}function al(aU,aV){return function(aW){window.parent.postMessage(aV+", "+aU,"*")}}function x(aU){if(!aa){return}aU=aU||aP;if(aU.canvas===null){aU.canvas=$('<canvas class="wmakml"></canvas>').attr({width:aT*s,height:af*s}).css({width:aT+"px",height:af+"px"}).appendTo($(C));aU.c=aU.canvas[0].getContext("2d");aU.c.scale(s,s);aU.shown=true;aU.drawn=true;if(aU==aP){$("#button_kml").show()}}if(aU===aP&&aB){aB.updateKML()}}function ao(aY){aY=aY.originalEvent;var aZ=JSON.parse(aY.data),aX,aV,aU;if("coords" in aZ){for(aX=0;aX<aZ.coords.length;++aX){aU={obj:null,lat:aZ.coords[aX].lat,lon:aZ.coords[aX].lon};if(Math.abs(aU.lat-N.lat)>0.0001||Math.abs(aU.lon-N.lon)>0.0001){aU.obj=$("<div></div>").attr("title",decodeURIComponent(aZ.coords[aX].title)).addClass("emarker").mouseover(al(aX,"highlight")).mouseout(al(aX,"unhighlight")).click(al(aX,"scroll")).appendTo($(C));g(aU);H.push(aU)}}}if(("ways" in aZ)||("areas" in aZ)){x();aP.ways=aZ.ways||null;aP.areas=aZ.areas||null;ad()}if(("minlon" in aZ)&&("maxlon" in aZ)){if(!("maxlon" in aP)||aZ.maxlon>aP.maxlon){aP.maxlon=aZ.maxlon}if(!("minlon" in aP)||aZ.minlon<aP.minlon){aP.minlon=aZ.minlon}}if("getcoords" in aZ){var a0={query:aZ.getcoords,response:{topleft:aH(E,D),rightbottom:aH(E+aT,D+af)}};if(window.parent){window.parent.postMessage(JSON.stringify(a0),aY.origin)}}if("moveto" in aZ){var aW=aZ.moveto;if("zoom" in aW){aq(aW.zoom)}if("lat" in aW&&"lon" in aW){aC(aW.lat,aW.lon);aB&&aB.setLatLon(aW.lat,aW.lon)}}}function F(a0,aZ){function aW(a6){var a3,a7,a1,bb=180/Math.PI,a4=Math.PI/2,a2=180/20037508.34,ba=[],a8=-Infinity,a5=Infinity,a9;for(a3=0;a3<a6.length;++a3){a1=a6[a3][0]*a2;a7=bb*(2*Math.atan(Math.exp(a6[a3][1]*a2/bb))-a4);if(a1>a8){a8=a1}if(a1<a5){a5=a1}if(a7>aZ.maxlat){aZ.maxlat=a7}if(a7<aZ.minlat){aZ.minlat=a7}ba.push({lat:a7,lon:a1})}if(!("maxlon" in aZ)||!("maxlon" in aZ)){aZ.maxlon=a8;aZ.minlon=a5}else{a9=[{r:Math.max(aZ.maxlon,a8),l:Math.min(aZ.minlon,a5)},{r:Math.max(aZ.maxlon,a8+360),l:Math.min(aZ.minlon,a5+360)},{r:Math.max(aZ.maxlon+360,a8),l:Math.min(aZ.minlon+360,a5)}];a9.sort(function(bd,bc){return(bd.r-bd.l)-(bc.r-bc.l)});aZ.minlon=a9[0].l;aZ.maxlon=a9[0].r}return ba}function aV(a3){var a2={outer:[],inner:[]},a1;a2.outer.push(aW(a3[0]));for(a1=1;a1<a3.length;a1++){a2.inner.push(aW(a3[a1]))}if(aZ.areas){aZ.areas.push(a2)}else{aZ.areas=[a2]}}function aU(a1){var a2=[aW(a1)];if(aZ.ways){aZ.ways.push.apply(aZ.ways,a2)}else{aZ.ways=a2}}function aY(a2){var a1;switch(a2.type){case"LineString":aU(a2.coordinates);break;case"MultiLineString":for(a1=0;a1<a2.coordinates.length;a1++){aU(a2.coordinates[a1])}break;case"Polygon":aV(a2.coordinates);break;case"MultiPolygon":for(a1=0;a1<a2.coordinates.length;a1++){aV(a2.coordinates[a1])}break}}var aX;if(!("type" in a0)){return}if(a0.type=="GeometryCollection"){for(aX=0;aX<a0.geometries.length;++aX){aY(a0.geometries[aX])}}else{aY(a0)}}function a(aZ){F(aZ,aP);if(aP.ways||aP.areas){x();ad()}if(aP.maxlon&&aP.minlon&&aP.maxlat>-Infinity&&aP.minlat<Infinity){var aY=(aP.maxlon+aP.minlon)/2,aX=(aP.maxlat+aP.minlat)/2,aW=(aP.maxlon-aP.minlon)/180*3*128,aU=(aP.maxlat-aP.minlat)/180*3*128,aV;for(aV=0;aV<12;++aV){if(aW>aT/2||aU>af/2){break}aW*=2;aU*=2}aq(aV);aC(aX,aY)}}function aw(a0){var a1=aM.c,aW=aM.canvas;if(aW){aM={shown:true,drawn:false,canvas:aW,c:a1,ways:null,areas:null,maxlat:-Infinity,minlat:Infinity}}else{aM={shown:true,drawn:false,canvas:null,c:null,ways:null,areas:null,maxlat:-Infinity,minlat:Infinity};x(aM)}F(a0,aM);var aV=aM.areas,aU=aM.ways,aZ=(aM.maxlon+aM.minlon)/2,aY=(aM.maxlat+aM.minlat)/2;function aX(a2){var a4,a3=0;if(a2[0].lon<aM.minlon){a3=360}for(a4=0;a4<a2.length;++a4){a2[a4].lon-=aZ-a3;a2[a4].lon*=Math.cos(a2[a4].lat/180*Math.PI);a2[a4].lat-=aY}}if(aV!==null){for(i=0;i<aV.length;++i){for(j=0;j<aV[i].outer.length;++j){aX(aV[i].outer[j])}for(j=0;j<aV[i].inner.length;++j){aX(aV[i].inner[j])}}}if(aU!==null){for(i=0;i<aU.length;++i){latNorm(aU[i])}}aM.canvas.fadeIn(200)}aQ()}function wmaMenu(a){this.div=$("<div></div>").addClass("wmamenu").css("direction",(a===true?"rtl":""));this.parent=null;this.shown=false}wmaMenu.prototype.addTitle=function(a,c){var b=$("<div></div>").addClass("wmamenutitle").html(a).css("direction",(c===true)?"rtl":"").appendTo(this.div);return b};wmaMenu.prototype.addItem=function(a,d,e){d=d||(function(){});var c=this,b=$("<div></div>").addClass("wmamenuitem").html(a).css("direction",(e===true)?"rtl":"").mouseenter(function(){b.css("background-color","#AAA")}).mouseleave(function(){b.css("background-color","")}).click(function(){d();c.close()}).appendTo(this.div);return b};wmaMenu.prototype.addMenu=function(a,d,c){var b=$("<div></div>").addClass("wmasubmenu").html(a).css("direction",(c===true)?"rtl":"").mouseenter(function(){b.css("background-color","#AAA")}).mouseleave(function(){b.css("background-color","");d.hide()}).click(function(){d.move(b.width(),0);d.show()}).append(d.div).appendTo(this.div);d.parent=this;return b};wmaMenu.prototype.addCheck=function(b,f,c,g){function a(){if(c){d.addClass("wmamenuchecked")}else{d.removeClass("wmamenuchecked")}}function e(){c=!c;a();f(c)}var d=this.addItem(b,e,g);f=f||(function(){});a();return{toggle:function(h){if(h===undefined){c=!c;a()}},check:a,item:d}};wmaMenu.prototype.addGroup=function(l,a,b,g){var f={},d=this,e=-1;function k(o){if(o==e){return}for(var m in f){if(m==o){f[m].addClass("wmamenuselected")}else{f[m].removeClass("wmamenuselected")}}e=o}function h(o,m){f[o]=d.addItem(m,function(){k(o);a(o)},g)}b=b||0;a=a||(function(){});for(var c=0;c<l.length;++c){if(typeof l[c]==="object"){h(l[c][0],l[c][1])}else{h(c,l[c])}}k(b);return{items:f,select:k,current:function(){return e},hide:function(){for(var m in f){f[m].hide()}},show:function(){for(var m in f){f[m].show()}}}};wmaMenu.prototype.addSep=function(){this.div.children().last().css({"border-bottom-style":"solid","border-bottom-width":"1px","border-bottom-color":"#AAA"})};wmaMenu.prototype.show=function(){this.div.fadeIn(200);this.shown=true};wmaMenu.prototype.hide=function(){this.div.fadeOut(200);this.shown=false};wmaMenu.prototype.toggle=function(){this.shown?this.hide():this.show()};wmaMenu.prototype.close=function(){this.hide();this.parent&&this.parent.close()};wmaMenu.prototype.move=function(a,b){this.div.css({top:b+"px",left:a+"px"})};